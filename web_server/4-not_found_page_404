#!/usr/bin/env bash
# This script installs Nginx and configures a 301 redirect and a custom 404 error page.

# 1. Install Nginx
apt-get update -y
apt-get install -y nginx

# 2. Create the custom 404 page file with the required string
CUSTOM_404_PAGE="/var/www/html/404.html"
echo "Ceci n'est pas une page" > "$CUSTOM_404_PAGE"

# 3. Configure Nginx: Add 301 redirect and custom 404 page directives
# error_page 404 /404.html; tells Nginx to use the custom page
# location = /404.html { ... internal; } ensures the file can only be served as an error page.
sed -i '/^server {/a \
        error_page 404 /404.html;\
        location = /404.html {\
            root /var/www/html;\
            internal;\
        }\
        rewrite ^/redirect_me https://www.youtube.com/watch?v=QH2-TGUlwu4 permanent;\
        \n' /etc/nginx/sites-available/default

# 4. Add the required content to the default index page (for Task 1 compliance)
echo "Holberton School" > /var/www/html/index.html

# 5. Restart Nginx service
service nginx restart
